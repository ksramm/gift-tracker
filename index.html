<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üéÅ Gift Tracker</title>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,600;0,700;1,600&family=DM+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --bg: #0e0b14;
  --surface: #16121f;
  --card: #1c1728;
  --border: #2a2238;
  --accent: #c47ed4;
  --accent2: #e8a87c;
  --accent3: #7cb8e8;
  --accent4: #7ce8a8;
  --accent5: #e87c8a;
  --text: #f0eaf8;
  --muted: #7a6d8a;
  --soft: #3a2f4a;
}

body {
  font-family: 'DM Sans', sans-serif;
  background: var(--bg);
  color: var(--text);
  min-height: 100vh;
  overflow-x: hidden;
}

/* Background orbs */
body::before {
  content: '';
  position: fixed;
  top: -200px; left: -200px;
  width: 600px; height: 600px;
  background: radial-gradient(circle, #c47ed420 0%, transparent 70%);
  pointer-events: none;
  z-index: 0;
}
body::after {
  content: '';
  position: fixed;
  bottom: -200px; right: -200px;
  width: 500px; height: 500px;
  background: radial-gradient(circle, #7cb8e820 0%, transparent 70%);
  pointer-events: none;
  z-index: 0;
}

/* Header */
.header {
  position: sticky; top: 0; z-index: 100;
  background: rgba(14, 11, 20, 0.85);
  backdrop-filter: blur(20px);
  border-bottom: 1px solid var(--border);
  padding: 0 32px;
  height: 68px;
  display: flex; align-items: center; justify-content: space-between;
}
.logo {
  display: flex; align-items: center; gap: 12px;
}
.logo-icon {
  width: 40px; height: 40px; border-radius: 12px;
  background: linear-gradient(135deg, #c47ed4, #7cb8e8);
  display: flex; align-items: center; justify-content: center;
  font-size: 20px;
  box-shadow: 0 4px 16px #c47ed440;
}
.logo-text { font-family: 'Cormorant Garamond', serif; font-size: 20px; font-weight: 700; color: var(--text); }
.logo-sub { font-size: 11px; color: var(--muted); letter-spacing: 0.1em; text-transform: uppercase; }

.btn-add {
  background: linear-gradient(135deg, #c47ed4, #9b5bb5);
  color: #fff;
  border: none; cursor: pointer;
  border-radius: 10px; padding: 10px 22px;
  font-family: 'DM Sans', sans-serif;
  font-size: 13px; font-weight: 600;
  display: flex; align-items: center; gap: 6px;
  box-shadow: 0 4px 20px #c47ed440;
  transition: transform 0.2s, box-shadow 0.2s;
}
.btn-add:hover { transform: translateY(-1px); box-shadow: 0 6px 24px #c47ed460; }

/* Layout */
.container { max-width: 1200px; margin: 0 auto; padding: 32px 24px 80px; position: relative; z-index: 1; }

/* Stat cards */
.stats-grid {
  display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 16px; margin-bottom: 32px;
}
.stat-card {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 16px;
  padding: 22px 24px;
  position: relative; overflow: hidden;
  transition: transform 0.2s, border-color 0.2s;
  animation: fadeUp 0.5s ease both;
}
.stat-card:hover { transform: translateY(-2px); }
.stat-card::before {
  content: '';
  position: absolute; top: 0; left: 0; right: 0; height: 2px;
  background: var(--c, #c47ed4);
}
.stat-label { font-size: 11px; color: var(--muted); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 8px; }
.stat-value { font-family: 'Cormorant Garamond', serif; font-size: 38px; font-weight: 700; color: var(--c, #c47ed4); line-height: 1; }
.stat-sub { font-size: 12px; color: var(--muted); margin-top: 4px; }

/* Tabs */
.tabs {
  display: flex; gap: 4px;
  background: var(--card); border: 1px solid var(--border);
  border-radius: 12px; padding: 4px;
  width: fit-content; margin-bottom: 24px;
}
.tab {
  padding: 8px 20px; border-radius: 9px; border: none; cursor: pointer;
  font-family: 'DM Sans', sans-serif; font-size: 13px; font-weight: 600;
  color: var(--muted); background: transparent;
  transition: all 0.2s;
}
.tab.active {
  background: linear-gradient(135deg, #c47ed4, #9b5bb5);
  color: #fff; box-shadow: 0 2px 12px #c47ed430;
}

/* Panel */
.panel { animation: fadeUp 0.3s ease; }

/* Filters */
.filters {
  background: var(--card); border: 1px solid var(--border);
  border-radius: 14px; padding: 16px 20px;
  display: flex; flex-wrap: wrap; gap: 10px; align-items: center;
  margin-bottom: 20px;
}
.filter-label { font-size: 11px; color: var(--muted); font-weight: 600; text-transform: uppercase; letter-spacing: 0.07em; }
select, input[type="date"], input[type="text"], input[type="number"] {
  background: var(--surface); border: 1px solid var(--border);
  color: var(--text); border-radius: 8px; padding: 7px 12px;
  font-family: 'DM Sans', sans-serif; font-size: 13px;
  outline: none; transition: border-color 0.2s;
  -webkit-appearance: none;
}
select:focus, input:focus { border-color: var(--accent); }
select option { background: var(--surface); }

.btn-reset {
  background: transparent; border: 1px solid #e87c8a44;
  color: #e87c8a; border-radius: 8px; padding: 7px 14px;
  font-size: 12px; font-weight: 600; cursor: pointer;
  transition: background 0.2s;
}
.btn-reset:hover { background: #e87c8a15; }

.sort-wrap { margin-left: auto; display: flex; align-items: center; gap: 8px; }

/* Table */
.table-wrap {
  background: var(--card); border: 1px solid var(--border);
  border-radius: 14px; overflow: hidden;
}
table { width: 100%; border-collapse: collapse; }
thead tr { background: var(--surface); border-bottom: 1px solid var(--border); }
th {
  padding: 13px 20px; text-align: left;
  font-size: 10px; color: var(--muted); font-weight: 700;
  text-transform: uppercase; letter-spacing: 0.1em;
}
tbody tr { border-bottom: 1px solid #1e1a2a; transition: background 0.15s; }
tbody tr:last-child { border-bottom: none; }
tbody tr:hover { background: #211c2e; }
td { padding: 14px 20px; }

.editor-avatar {
  width: 34px; height: 34px; border-radius: 10px;
  display: flex; align-items: center; justify-content: center;
  font-size: 14px; font-weight: 700; flex-shrink: 0;
}
.editor-cell { display: flex; align-items: center; gap: 10px; }
.editor-name { font-size: 14px; font-weight: 600; }

.coll-tag {
  background: #2a2040; color: #b090d0;
  border-radius: 6px; padding: 4px 10px;
  font-size: 13px; display: inline-block;
}

.count-val {
  font-family: 'Cormorant Garamond', serif;
  font-size: 22px; font-weight: 700;
}

.date-val { font-size: 13px; color: var(--muted); }

.btn-del {
  opacity: 0; background: transparent;
  border: 1px solid #e87c8a44; color: #e87c8a;
  border-radius: 6px; padding: 4px 10px;
  font-size: 12px; font-weight: 600; cursor: pointer;
  transition: all 0.2s;
}
tbody tr:hover .btn-del { opacity: 1; }
.btn-del:hover { background: #e87c8a15; }

.table-empty { padding: 48px; text-align: center; color: var(--muted); font-size: 14px; }
.table-footer { padding: 10px 20px; font-size: 12px; color: var(--muted); text-align: right; border-top: 1px solid var(--border); }

/* Editor cards */
.editors-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 16px; }
.editor-card {
  background: var(--card); border-radius: 16px;
  border: 1px solid var(--border); overflow: hidden;
  transition: transform 0.2s; animation: fadeUp 0.4s ease both;
}
.editor-card:hover { transform: translateY(-2px); }
.editor-card-head {
  padding: 20px 24px;
  display: flex; align-items: center; gap: 14px;
  border-bottom: 1px solid var(--border);
}
.editor-card-big-avatar {
  width: 48px; height: 48px; border-radius: 14px;
  display: flex; align-items: center; justify-content: center;
  font-size: 20px; font-weight: 800; flex-shrink: 0;
}
.editor-card-name { font-family: 'Cormorant Garamond', serif; font-size: 18px; font-weight: 700; }
.editor-card-meta { font-size: 12px; color: var(--muted); }
.editor-card-total {
  margin-left: auto; text-align: right;
}
.editor-card-total-num {
  font-family: 'Cormorant Garamond', serif; font-size: 30px; font-weight: 700; line-height: 1;
}
.editor-card-total-label { font-size: 11px; color: var(--muted); }
.editor-card-body { padding: 4px 0; }
.editor-entry {
  padding: 10px 24px;
  display: flex; justify-content: space-between; align-items: center;
  border-top: 1px solid #1e1a2a;
}
.editor-entry-coll { font-size: 13px; font-weight: 600; color: var(--text); }
.editor-entry-date { font-size: 11px; color: var(--muted); margin-top: 2px; }
.editor-entry-count { font-family: 'Cormorant Garamond', serif; font-size: 18px; font-weight: 700; }
.editor-card-bar { padding: 12px 24px 16px; }
.bar-info { display: flex; justify-content: space-between; font-size: 11px; color: var(--muted); margin-bottom: 6px; }
.bar-track { background: var(--soft); border-radius: 4px; height: 6px; overflow: hidden; }
.bar-fill { height: 100%; border-radius: 4px; transition: width 0.8s cubic-bezier(.4,0,.2,1); }
.editor-empty { padding: 20px 24px; font-size: 13px; color: var(--muted); text-align: center; }

/* Collections */
.coll-list { background: var(--card); border: 1px solid var(--border); border-radius: 16px; overflow: hidden; }
.coll-item { padding: 22px 28px; border-bottom: 1px solid #1e1a2a; }
.coll-item:last-child { border-bottom: none; }
.coll-item-top { display: flex; align-items: center; gap: 14px; margin-bottom: 10px; }
.coll-item-icon { width: 38px; height: 38px; border-radius: 10px; background: var(--soft); display: flex; align-items: center; justify-content: center; font-size: 18px; flex-shrink: 0; }
.coll-item-name { font-size: 16px; font-weight: 700; }
.coll-item-meta { font-size: 12px; color: var(--muted); margin-top: 2px; }
.coll-item-count { margin-left: auto; text-align: right; }
.coll-item-count-num { font-family: 'Cormorant Garamond', serif; font-size: 26px; font-weight: 700; color: var(--accent); }
.coll-item-count-label { font-size: 11px; color: var(--muted); }
.coll-bar-track { background: var(--soft); border-radius: 6px; height: 8px; overflow: hidden; margin-bottom: 10px; }
.coll-bar-fill { height: 100%; border-radius: 6px; background: linear-gradient(90deg, #c47ed4, #7cb8e8); transition: width 0.8s cubic-bezier(.4,0,.2,1); }
.coll-editors-chips { display: flex; flex-wrap: wrap; gap: 6px; }
.chip { border-radius: 20px; padding: 3px 10px; font-size: 12px; font-weight: 600; }

/* Modal */
.modal-overlay {
  position: fixed; inset: 0; z-index: 1000;
  background: rgba(8, 6, 14, 0.8);
  backdrop-filter: blur(8px);
  display: flex; align-items: center; justify-content: center;
  opacity: 0; pointer-events: none;
  transition: opacity 0.3s;
}
.modal-overlay.open { opacity: 1; pointer-events: all; }
.modal {
  background: var(--card); border: 1px solid var(--border);
  border-radius: 20px; padding: 36px 40px; width: 440px; max-width: 95vw;
  box-shadow: 0 24px 80px #00000060;
  transform: translateY(20px) scale(0.97);
  transition: transform 0.3s;
}
.modal-overlay.open .modal { transform: translateY(0) scale(1); }
.modal-title { font-family: 'Cormorant Garamond', serif; font-size: 26px; font-weight: 700; margin-bottom: 4px; }
.modal-sub { font-size: 13px; color: var(--muted); margin-bottom: 28px; }
.form-group { margin-bottom: 18px; }
.form-label { display: block; font-size: 11px; color: var(--muted); font-weight: 700; text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 7px; }
.form-group select, .form-group input { width: 100%; }
.modal-actions { display: flex; gap: 10px; margin-top: 28px; }
.btn-cancel {
  flex: 1; padding: 12px; border-radius: 10px;
  border: 1px solid var(--border); background: transparent;
  color: var(--muted); font-family: 'DM Sans', sans-serif;
  font-size: 14px; font-weight: 600; cursor: pointer;
  transition: border-color 0.2s;
}
.btn-cancel:hover { border-color: var(--accent); color: var(--text); }
.btn-confirm {
  flex: 2; padding: 12px; border-radius: 10px; border: none;
  background: linear-gradient(135deg, #c47ed4, #9b5bb5);
  color: #fff; font-family: 'DM Sans', sans-serif;
  font-size: 14px; font-weight: 700; cursor: pointer;
  box-shadow: 0 4px 16px #c47ed440;
  transition: transform 0.2s, box-shadow 0.2s;
}
.btn-confirm:hover { transform: translateY(-1px); box-shadow: 0 6px 20px #c47ed460; }

/* Toast */
.toast {
  position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%) translateY(80px);
  background: var(--card); border: 1px solid var(--accent);
  color: var(--text); border-radius: 10px; padding: 12px 24px;
  font-size: 14px; font-weight: 600; z-index: 2000;
  transition: transform 0.3s; box-shadow: 0 8px 30px #00000040;
}
.toast.show { transform: translateX(-50%) translateY(0); }

/* Animations */
@keyframes fadeUp {
  from { opacity: 0; transform: translateY(16px); }
  to { opacity: 1; transform: translateY(0); }
}

/* Scrollbar */
::-webkit-scrollbar { width: 6px; height: 6px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: var(--soft); border-radius: 3px; }

/* Responsive */
@media (max-width: 600px) {
  .header { padding: 0 16px; }
  .container { padding: 20px 12px 60px; }
  .logo-sub { display: none; }
  .stat-value { font-size: 30px; }
  th:last-child, td:last-child { display: none; }
}
</style>
</head>
<body>

<header class="header">
  <div class="logo">
    <div class="logo-icon">üéÅ</div>
    <div>
      <div class="logo-text">Gift Tracker</div>
      <div class="logo-sub">–°–∏—Å—Ç–µ–º–∞ –æ—Ç—á—ë—Ç–Ω–æ—Å—Ç–∏ —Ä–µ–¥–∞–∫—Ç–æ—Ä–æ–≤</div>
    </div>
  </div>
  <button class="btn-add" onclick="openModal()">
    <span style="font-size:16px">Ôºã</span> –î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å
  </button>
</header>

<div class="container">
  <div class="stats-grid" id="statsGrid"></div>

  <div class="tabs">
    <button class="tab active" onclick="switchTab('log', this)">üìã –ñ—É—Ä–Ω–∞–ª</button>
    <button class="tab" onclick="switchTab('editors', this)">üë©‚Äçüíº –ü–æ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞–º</button>
    <button class="tab" onclick="switchTab('collections', this)">üì¶ –ü–æ –ø–æ–¥–±–æ—Ä–∫–∞–º</button>
  </div>

  <div id="panel-log" class="panel"></div>
  <div id="panel-editors" class="panel" style="display:none"></div>
  <div id="panel-collections" class="panel" style="display:none"></div>
</div>

<!-- Modal -->
<div class="modal-overlay" id="modalOverlay" onclick="closeModalOutside(event)">
  <div class="modal">
    <div class="modal-title">–ù–æ–≤–∞—è –∑–∞–ø–∏—Å—å</div>
    <div class="modal-sub">–î–æ–±–∞–≤—å—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø–æ–¥–±–æ—Ä–∫–∏</div>
    <div class="form-group">
      <label class="form-label">–†–µ–¥–∞–∫—Ç–æ—Ä</label>
      <select id="fEditor"></select>
    </div>
    <div class="form-group">
      <label class="form-label">–ü–æ–¥–±–æ—Ä–∫–∞</label>
      <select id="fCollection"></select>
    </div>
    <div class="form-group">
      <label class="form-label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö –∏–¥–µ–π</label>
      <input type="number" id="fCount" min="1" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 10">
    </div>
    <div class="form-group">
      <label class="form-label">–î–∞—Ç–∞</label>
      <input type="date" id="fDate">
    </div>
    <div class="modal-actions">
      <button class="btn-cancel" onclick="closeModal()">–û—Ç–º–µ–Ω–∞</button>
      <button class="btn-confirm" onclick="addEntry()">Ôºã –î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å</button>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
// ‚îÄ‚îÄ‚îÄ CONFIG ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// ‚úèÔ∏è –ù–ê–°–¢–†–û–ô–¢–ï –ü–û–î –°–ï–ë–Ø: –¥–æ–±–∞–≤—å—Ç–µ/—É–¥–∞–ª–∏—Ç–µ —Ä–µ–¥–∞–∫—Ç–æ—Ä–æ–≤ –∏ –ø–æ–¥–±–æ—Ä–∫–∏
const EDITORS = ["–ê–Ω–Ω–∞", "–ú–∞—Ä–∏—è", "–î–∞—Ä—å—è", "–û–ª—å–≥–∞", "–ï–∫–∞—Ç–µ—Ä–∏–Ω–∞"];
const COLLECTIONS = ["–î–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è", "–ù–æ–≤—ã–π –≥–æ–¥", "23 —Ñ–µ–≤—Ä–∞–ª—è", "8 –º–∞—Ä—Ç–∞", "–°–≤–∞–¥—å–±–∞", "–î–µ—Ç—è–º", "–ï–º—É", "–ï–π", "–ö–æ–ª–ª–µ–≥–µ"];

const COLORS = {
  "–ê–Ω–Ω–∞":      { bg: "#3a1a1a", text: "#e87c8a", bar: "#e87c8a" },
  "–ú–∞—Ä–∏—è":     { bg: "#1a2a3a", text: "#7cb8e8", bar: "#7cb8e8" },
  "–î–∞—Ä—å—è":     { bg: "#1a3a2a", text: "#7ce8a8", bar: "#7ce8a8" },
  "–û–ª—å–≥–∞":     { bg: "#3a2a1a", text: "#e8a87c", bar: "#e8a87c" },
  "–ï–∫–∞—Ç–µ—Ä–∏–Ω–∞": { bg: "#2a1a3a", text: "#c47ed4", bar: "#c47ed4" },
};
function getColor(name) {
  return COLORS[name] || { bg: "#2a2a3a", text: "#a0a0c0", bar: "#a0a0c0" };
}

// ‚îÄ‚îÄ‚îÄ DATA ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const STORAGE_KEY = "gift_tracker_v2";

function loadData() {
  try {
    const raw = localStorage.getItem(STORAGE_KEY);
    if (raw) return JSON.parse(raw);
  } catch(e) {}
  // –î–µ–º–æ-–¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ
  return [
    { id: 1, editor: "–ê–Ω–Ω–∞",      collection: "–î–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è", count: 12, date: "2026-02-10" },
    { id: 2, editor: "–ú–∞—Ä–∏—è",     collection: "–ù–æ–≤—ã–π –≥–æ–¥",      count: 8,  date: "2026-02-11" },
    { id: 3, editor: "–î–∞—Ä—å—è",     collection: "8 –º–∞—Ä—Ç–∞",        count: 15, date: "2026-02-12" },
    { id: 4, editor: "–ê–Ω–Ω–∞",      collection: "–°–≤–∞–¥—å–±–∞",        count: 6,  date: "2026-02-13" },
    { id: 5, editor: "–û–ª—å–≥–∞",     collection: "–î–µ—Ç—è–º",          count: 20, date: "2026-02-14" },
    { id: 6, editor: "–ú–∞—Ä–∏—è",     collection: "23 —Ñ–µ–≤—Ä–∞–ª—è",     count: 9,  date: "2026-02-14" },
    { id: 7, editor: "–ï–∫–∞—Ç–µ—Ä–∏–Ω–∞", collection: "–ï–º—É",            count: 11, date: "2026-02-15" },
    { id: 8, editor: "–î–∞—Ä—å—è",     collection: "–î–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è",  count: 7,  date: "2026-02-15" },
    { id: 9, editor: "–û–ª—å–≥–∞",     collection: "–ö–æ–ª–ª–µ–≥–µ",        count: 14, date: "2026-02-16" },
    { id: 10, editor: "–ê–Ω–Ω–∞",     collection: "–ï–π",             count: 18, date: "2026-02-17" },
    { id: 11, editor: "–ï–∫–∞—Ç–µ—Ä–∏–Ω–∞",collection: "–ù–æ–≤—ã–π –≥–æ–¥",      count: 5,  date: "2026-02-17" },
    { id: 12, editor: "–ú–∞—Ä–∏—è",    collection: "8 –º–∞—Ä—Ç–∞",        count: 22, date: "2026-02-17" },
  ];
}

function saveData(data) {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
}

let entries = loadData();
let filterEditor = "–í—Å–µ", filterCollection = "–í—Å–µ", filterDate = "", sortBy = "date_desc";
let activeTab = "log";

// ‚îÄ‚îÄ‚îÄ HELPERS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function fmtDate(d) {
  const [y, m, day] = d.split("-");
  const months = ["—è–Ω–≤","—Ñ–µ–≤","–º–∞—Ä","–∞–ø—Ä","–º–∞–π","–∏—é–Ω","–∏—é–ª","–∞–≤–≥","—Å–µ–Ω","–æ–∫—Ç","–Ω–æ—è","–¥–µ–∫"];
  return `${parseInt(day)} ${months[parseInt(m)-1]} ${y}`;
}

function getFiltered() {
  let data = [...entries];
  if (filterEditor !== "–í—Å–µ") data = data.filter(e => e.editor === filterEditor);
  if (filterCollection !== "–í—Å–µ") data = data.filter(e => e.collection === filterCollection);
  if (filterDate) data = data.filter(e => e.date === filterDate);
  if (sortBy === "date_desc")  data.sort((a,b) => b.date.localeCompare(a.date));
  if (sortBy === "date_asc")   data.sort((a,b) => a.date.localeCompare(b.date));
  if (sortBy === "count_desc") data.sort((a,b) => b.count - a.count);
  if (sortBy === "count_asc")  data.sort((a,b) => a.count - b.count);
  return data;
}

function getStats() {
  const total = entries.reduce((s,e) => s + e.count, 0);
  const today = new Date().toISOString().split("T")[0];
  const todayCount = entries.filter(e => e.date === today).reduce((s,e) => s + e.count, 0);
  const byEditor = EDITORS.map(ed => ({
    name: ed,
    total: entries.filter(e => e.editor === ed).reduce((s,e) => s + e.count, 0),
    updates: entries.filter(e => e.editor === ed).length,
  })).sort((a,b) => b.total - a.total);
  const byCollection = COLLECTIONS.map(col => ({
    name: col,
    total: entries.filter(e => e.collection === col).reduce((s,e) => s + e.count, 0),
    updates: entries.filter(e => e.collection === col).length,
  })).filter(c => c.total > 0).sort((a,b) => b.total - a.total);
  return { total, todayCount, byEditor, byCollection };
}

// ‚îÄ‚îÄ‚îÄ RENDER STATS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderStats() {
  const s = getStats();
  const cards = [
    { label: "–í—Å–µ–≥–æ –∏–¥–µ–π –¥–æ–±–∞–≤–ª–µ–Ω–æ", value: s.total, sub: "–∑–∞ –≤—Å—ë –≤—Ä–µ–º—è", c: "#c47ed4" },
    { label: "–î–æ–±–∞–≤–ª–µ–Ω–æ —Å–µ–≥–æ–¥–Ω—è",    value: s.todayCount, sub: "17 —Ñ–µ–≤—Ä–∞–ª—è 2026", c: "#e8a87c" },
    { label: "–í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π",        value: entries.length, sub: "–æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –ø–æ–¥–±–æ—Ä–æ–∫", c: "#7cb8e8" },
    { label: "–õ–∏–¥–µ—Ä –ø–æ –∏–¥–µ—è–º",       value: s.byEditor[0]?.name || "‚Äî", sub: (s.byEditor[0]?.total || 0) + " –∏–¥–µ–π", c: "#e87c8a" },
  ];
  document.getElementById("statsGrid").innerHTML = cards.map((c, i) => `
    <div class="stat-card" style="--c:${c.c}; animation-delay:${i*0.07}s">
      <div class="stat-label">${c.label}</div>
      <div class="stat-value">${c.value}</div>
      <div class="stat-sub">${c.sub}</div>
    </div>
  `).join("");
}

// ‚îÄ‚îÄ‚îÄ RENDER LOG ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderLog() {
  const filtered = getFiltered();
  const hasFilters = filterEditor !== "–í—Å–µ" || filterCollection !== "–í—Å–µ" || filterDate;

  document.getElementById("panel-log").innerHTML = `
    <div class="filters">
      <span class="filter-label">–§–∏–ª—å—Ç—Ä—ã:</span>
      <select onchange="filterEditor=this.value; renderAll()">
        <option>–í—Å–µ</option>
        ${EDITORS.map(e => `<option ${filterEditor===e?"selected":""}>${e}</option>`).join("")}
      </select>
      <select onchange="filterCollection=this.value; renderAll()">
        <option>–í—Å–µ</option>
        ${COLLECTIONS.map(c => `<option ${filterCollection===c?"selected":""}>${c}</option>`).join("")}
      </select>
      <input type="date" value="${filterDate}" onchange="filterDate=this.value; renderAll()">
      ${hasFilters ? `<button class="btn-reset" onclick="filterEditor='–í—Å–µ';filterCollection='–í—Å–µ';filterDate='';renderAll()">‚úï –°–±—Ä–æ—Å–∏—Ç—å</button>` : ""}
      <div class="sort-wrap">
        <span class="filter-label">–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞:</span>
        <select onchange="sortBy=this.value; renderAll()">
          <option value="date_desc"  ${sortBy==="date_desc" ?"selected":""}>–°–Ω–∞—á–∞–ª–∞ –Ω–æ–≤—ã–µ</option>
          <option value="date_asc"   ${sortBy==="date_asc"  ?"selected":""}>–°–Ω–∞—á–∞–ª–∞ —Å—Ç–∞—Ä—ã–µ</option>
          <option value="count_desc" ${sortBy==="count_desc"?"selected":""}>–ë–æ–ª—å—à–µ –∏–¥–µ–π</option>
          <option value="count_asc"  ${sortBy==="count_asc" ?"selected":""}>–ú–µ–Ω—å—à–µ –∏–¥–µ–π</option>
        </select>
      </div>
    </div>
    <div class="table-wrap">
      <table>
        <thead>
          <tr>
            <th>–†–µ–¥–∞–∫—Ç–æ—Ä</th><th>–ü–æ–¥–±–æ—Ä–∫–∞</th><th>–ò–¥–µ–π –¥–æ–±–∞–≤–ª–µ–Ω–æ</th><th>–î–∞—Ç–∞</th><th></th>
          </tr>
        </thead>
        <tbody>
          ${filtered.length === 0
            ? `<tr><td colspan="5" class="table-empty">–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π –ø–æ –≤—ã–±—Ä–∞–Ω–Ω—ã–º —Ñ–∏–ª—å—Ç—Ä–∞–º</td></tr>`
            : filtered.map(e => {
                const c = getColor(e.editor);
                return `
                  <tr>
                    <td>
                      <div class="editor-cell">
                        <div class="editor-avatar" style="background:${c.bg};color:${c.text}">${e.editor[0]}</div>
                        <span class="editor-name">${e.editor}</span>
                      </div>
                    </td>
                    <td><span class="coll-tag">üéÅ ${e.collection}</span></td>
                    <td><span class="count-val" style="color:${c.text}">${e.count}</span> <span style="font-size:12px;color:var(--muted)">–∏–¥–µ–π</span></td>
                    <td><span class="date-val">${fmtDate(e.date)}</span></td>
                    <td><button class="btn-del" onclick="deleteEntry(${e.id})">–£–¥–∞–ª–∏—Ç—å</button></td>
                  </tr>`;
              }).join("")
          }
        </tbody>
      </table>
      <div class="table-footer">–ü–æ–∫–∞–∑–∞–Ω–æ: ${filtered.length} –∏–∑ ${entries.length} –∑–∞–ø–∏—Å–µ–π</div>
    </div>
  `;
}

// ‚îÄ‚îÄ‚îÄ RENDER EDITORS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderEditors() {
  const s = getStats();
  const totalAll = s.total;
  document.getElementById("panel-editors").innerHTML = `
    <div class="editors-grid">
      ${s.byEditor.map((ed, i) => {
        const c = getColor(ed.name);
        const edEntries = entries.filter(e => e.editor === ed.name).sort((a,b) => b.date.localeCompare(a.date)).slice(0,4);
        const pct = totalAll > 0 ? Math.round(ed.total / totalAll * 100) : 0;
        return `
          <div class="editor-card" style="animation-delay:${i*0.08}s">
            <div class="editor-card-head">
              <div class="editor-card-big-avatar" style="background:${c.bg};color:${c.text}">${ed.name[0]}</div>
              <div>
                <div class="editor-card-name">${ed.name}</div>
                <div class="editor-card-meta">${ed.updates} –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π</div>
              </div>
              <div class="editor-card-total">
                <div class="editor-card-total-num" style="color:${c.text}">${ed.total}</div>
                <div class="editor-card-total-label">–∏–¥–µ–π</div>
              </div>
            </div>
            <div class="editor-card-body">
              ${edEntries.length === 0
                ? `<div class="editor-empty">–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π</div>`
                : edEntries.map(e => `
                    <div class="editor-entry">
                      <div>
                        <div class="editor-entry-coll">${e.collection}</div>
                        <div class="editor-entry-date">${fmtDate(e.date)}</div>
                      </div>
                      <div class="editor-entry-count" style="color:${c.text}">+${e.count}</div>
                    </div>`).join("")
              }
              ${ed.updates > 4 ? `<div style="padding:8px 24px;font-size:12px;color:var(--muted);border-top:1px solid #1e1a2a">+ –µ—â—ë ${ed.updates-4} –∑–∞–ø–∏—Å–µ–π</div>` : ""}
            </div>
            <div class="editor-card-bar">
              <div class="bar-info">
                <span>–î–æ–ª—è –æ—Ç –æ–±—â–µ–≥–æ</span>
                <span style="color:${c.text};font-weight:700">${pct}%</span>
              </div>
              <div class="bar-track">
                <div class="bar-fill" style="width:${pct}%;background:${c.bar}"></div>
              </div>
            </div>
          </div>`;
      }).join("")}
    </div>
  `;
}

// ‚îÄ‚îÄ‚îÄ RENDER COLLECTIONS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderCollections() {
  const s = getStats();
  const maxC = Math.max(...s.byCollection.map(c => c.total), 1);
  document.getElementById("panel-collections").innerHTML = `
    <div class="coll-list">
      ${s.byCollection.length === 0
        ? `<div class="table-empty">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</div>`
        : s.byCollection.map(col => {
            const pct = Math.round(col.total / maxC * 100);
            const colEntries = entries.filter(e => e.collection === col.name);
            const editors = [...new Set(colEntries.map(e => e.editor))];
            return `
              <div class="coll-item">
                <div class="coll-item-top">
                  <div class="coll-item-icon">üéÅ</div>
                  <div>
                    <div class="coll-item-name">${col.name}</div>
                    <div class="coll-item-meta">${col.updates} –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π</div>
                  </div>
                  <div class="coll-item-count">
                    <div class="coll-item-count-num">${col.total}</div>
                    <div class="coll-item-count-label">–∏–¥–µ–π</div>
                  </div>
                </div>
                <div class="coll-bar-track">
                  <div class="coll-bar-fill" style="width:${pct}%"></div>
                </div>
                <div class="coll-editors-chips">
                  ${editors.map(ed => {
                    const c = getColor(ed);
                    const cnt = colEntries.filter(e => e.editor === ed).reduce((s,e) => s+e.count, 0);
                    return `<span class="chip" style="background:${c.bg};color:${c.text}">${ed}: ${cnt}</span>`;
                  }).join("")}
                </div>
              </div>`;
          }).join("")
      }
    </div>
  `;
}

// ‚îÄ‚îÄ‚îÄ RENDER ALL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderAll() {
  renderStats();
  if (activeTab === "log")         renderLog();
  else if (activeTab === "editors")    renderEditors();
  else if (activeTab === "collections") renderCollections();
}

// ‚îÄ‚îÄ‚îÄ TABS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function switchTab(name, btn) {
  activeTab = name;
  document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
  btn.classList.add("active");
  ["log","editors","collections"].forEach(t => {
    document.getElementById("panel-"+t).style.display = t === name ? "" : "none";
  });
  renderAll();
}

// ‚îÄ‚îÄ‚îÄ MODAL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function openModal() {
  const sel = document.getElementById("fEditor");
  const selC = document.getElementById("fCollection");
  sel.innerHTML = EDITORS.map(e => `<option>${e}</option>`).join("");
  selC.innerHTML = COLLECTIONS.map(c => `<option>${c}</option>`).join("");
  document.getElementById("fCount").value = "";
  document.getElementById("fDate").value = new Date().toISOString().split("T")[0];
  document.getElementById("modalOverlay").classList.add("open");
}
function closeModal() {
  document.getElementById("modalOverlay").classList.remove("open");
}
function closeModalOutside(e) {
  if (e.target === document.getElementById("modalOverlay")) closeModal();
}

function addEntry() {
  const editor = document.getElementById("fEditor").value;
  const collection = document.getElementById("fCollection").value;
  const countRaw = document.getElementById("fCount").value;
  const date = document.getElementById("fDate").value;
  const count = parseInt(countRaw);
  if (!count || count <= 0) { showToast("‚ö†Ô∏è –í–≤–µ–¥–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–¥–µ–π"); return; }
  if (!date) { showToast("‚ö†Ô∏è –í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É"); return; }
  entries.unshift({ id: Date.now(), editor, collection, count, date });
  saveData(entries);
  closeModal();
  renderAll();
  showToast("‚úÖ –ó–∞–ø–∏—Å—å –¥–æ–±–∞–≤–ª–µ–Ω–∞!");
}

function deleteEntry(id) {
  entries = entries.filter(e => e.id !== id);
  saveData(entries);
  renderAll();
  showToast("üóë –ó–∞–ø–∏—Å—å —É–¥–∞–ª–µ–Ω–∞");
}

// ‚îÄ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function showToast(msg) {
  const t = document.getElementById("toast");
  t.textContent = msg;
  t.classList.add("show");
  setTimeout(() => t.classList.remove("show"), 2500);
}

// ‚îÄ‚îÄ‚îÄ INIT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
renderAll();
</script>
</body>
</html>
