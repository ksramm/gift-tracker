<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üéÅ Gift Tracker</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;800&family=Raleway:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

body {
  font-family: 'Raleway', sans-serif;
  background: linear-gradient(135deg, #fdf6f0 0%, #f8f0fb 50%, #f0f6fd 100%);
  min-height: 100vh;
  padding-bottom: 60px;
}

button { cursor: pointer; border: none; background: none; font-family: inherit; }
input, select { font-family: inherit; }

::-webkit-scrollbar { width: 6px; height: 6px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: #e0d0f0; border-radius: 3px; }

/* HEADER */
.header {
  position: sticky; top: 0; z-index: 100;
  background: #fff;
  border-bottom: 1.5px solid #f0e8fb;
  padding: 0 32px;
  height: 70px;
  display: flex; align-items: center; justify-content: space-between;
  box-shadow: 0 2px 20px #e0c8f020;
}
.logo { display: flex; align-items: center; gap: 12px; }
.logo-icon {
  width: 38px; height: 38px; border-radius: 10px;
  background: linear-gradient(135deg, #E8A0BF, #957DAD);
  display: flex; align-items: center; justify-content: center;
  font-size: 20px;
}
.logo-title { font-size: 17px; font-weight: 800; color: #2d1f3d; font-family: 'Playfair Display', serif; }
.logo-sub { font-size: 11px; color: #b0a0c0; letter-spacing: 0.08em; text-transform: uppercase; }

.btn-add {
  background: linear-gradient(135deg, #957DAD, #c4a0d8);
  color: #fff; border-radius: 10px; padding: 9px 20px;
  font-size: 13px; font-weight: 700; letter-spacing: 0.03em;
  box-shadow: 0 4px 14px #957DAD40;
  display: flex; align-items: center; gap: 6px;
  transition: transform 0.2s, box-shadow 0.2s;
}
.btn-add:hover { transform: translateY(-1px); box-shadow: 0 6px 20px #957DAD60; }

/* CONTAINER */
.container { max-width: 1200px; margin: 0 auto; padding: 32px 24px 0; }

/* STAT CARDS */
.stats-grid {
  display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
  gap: 16px; margin-bottom: 32px;
}
.stat-card {
  background: #fff;
  border-radius: 16px; padding: 20px 24px;
  display: flex; flex-direction: column; gap: 4px;
  transition: transform 0.2s;
  animation: fadeUp 0.4s ease both;
}
.stat-card:hover { transform: translateY(-2px); }
.stat-label { font-size: 13px; color: #999; letter-spacing: 0.05em; text-transform: uppercase; }
.stat-value { font-family: 'Playfair Display', serif; font-size: 32px; font-weight: 800; line-height: 1; }
.stat-sub { font-size: 12px; color: #bbb; }

/* TABS */
.tabs {
  display: flex; gap: 4px;
  background: #fff; border: 1.5px solid #f0e8fb;
  border-radius: 12px; padding: 4px;
  width: fit-content; margin-bottom: 24px;
}
.tab {
  padding: 8px 20px; border-radius: 9px;
  font-size: 13px; font-weight: 600; color: #9a88b0;
  background: transparent; transition: all 0.2s; cursor: pointer; border: none;
  font-family: 'Raleway', sans-serif;
}
.tab.active {
  background: linear-gradient(135deg, #957DAD, #c4a0d8);
  color: #fff; box-shadow: 0 2px 10px #957DAD30;
}

/* PANEL */
.panel { animation: fadeUp 0.3s ease; }

/* FILTERS */
.filters {
  background: #fff; border-radius: 14px; border: 1.5px solid #f0e8fb;
  padding: 16px 20px; margin-bottom: 20px;
  display: flex; flex-wrap: wrap; gap: 12px; align-items: center;
}
.filter-label { font-size: 12px; color: #b0a0c0; font-weight: 700; text-transform: uppercase; letter-spacing: 0.07em; }
select, input[type="date"], input[type="number"] {
  border: 1.5px solid #e8d8f8; border-radius: 8px; padding: 6px 12px;
  font-size: 13px; color: #4a3060; background: #faf8ff; outline: none;
  transition: border-color 0.2s;
}
select:focus, input:focus { border-color: #957DAD; }
.btn-reset {
  font-size: 12px; color: #E05252; font-weight: 700;
  padding: 6px 12px; border: 1.5px solid #fde0e0; border-radius: 8px;
  background: #fff8f8; cursor: pointer;
}
.btn-reset:hover { background: #fde0e0; }
.sort-wrap { margin-left: auto; display: flex; align-items: center; gap: 8px; }

/* TABLE */
.table-wrap {
  background: #fff; border-radius: 14px; border: 1.5px solid #f0e8fb; overflow: hidden;
}
table { width: 100%; border-collapse: collapse; }
thead tr { background: #faf7ff; border-bottom: 1.5px solid #f0e8fb; }
th {
  padding: 13px 20px; text-align: left;
  font-size: 11px; color: #b0a0c0; font-weight: 700;
  text-transform: uppercase; letter-spacing: 0.08em;
}
tbody tr { border-bottom: 1px solid #f5f0fc; transition: background 0.15s; }
tbody tr:last-child { border-bottom: none; }
tbody tr:hover { background: #faf8ff; }
td { padding: 14px 20px; }

.editor-cell { display: flex; align-items: center; gap: 10px; }
.editor-avatar {
  width: 32px; height: 32px; border-radius: 10px;
  display: flex; align-items: center; justify-content: center;
  font-size: 14px; font-weight: 700; flex-shrink: 0;
}
.editor-name { font-size: 14px; font-weight: 600; color: #2d1f3d; }
.coll-tag { background: #f5f0fc; color: #5a4070; border-radius: 6px; padding: 4px 10px; font-size: 13px; }
.count-cell { display: flex; align-items: center; gap: 6px; }
.count-num { font-family: 'Playfair Display', serif; font-size: 20px; font-weight: 800; }
.count-unit { font-size: 12px; color: #c0b0d0; }
.date-val { font-size: 13px; color: #8070a0; }
.btn-del {
  opacity: 0; color: #E05252; font-size: 12px; font-weight: 700;
  padding: 4px 10px; border: 1.5px solid #fde0e0; border-radius: 6px;
  background: #fff8f8; transition: opacity 0.2s; cursor: pointer;
}
tbody tr:hover .btn-del { opacity: 1; }
.table-empty { padding: 48px; text-align: center; color: #c0b0d0; font-size: 14px; }
.table-footer { padding: 10px 20px; font-size: 12px; color: #c0b0d0; text-align: right; border-top: 1px solid #f5f0fc; }

/* EDITOR CARDS */
.editors-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 16px; }
.editor-card {
  background: #fff; border-radius: 16px; border: 1.5px solid #f0e8fb;
  overflow: hidden; transition: transform 0.2s; animation: fadeUp 0.4s ease both;
}
.editor-card:hover { transform: translateY(-2px); }
.editor-card-head {
  padding: 20px 24px; display: flex; align-items: center; gap: 14px;
  border-bottom: 1.5px solid #f5f0fc;
}
.editor-big-avatar {
  width: 46px; height: 46px; border-radius: 14px;
  display: flex; align-items: center; justify-content: center;
  font-size: 20px; font-weight: 800; flex-shrink: 0;
}
.editor-card-name { font-family: 'Playfair Display', serif; font-weight: 800; font-size: 16px; color: #2d1f3d; }
.editor-card-meta { font-size: 12px; color: #a090b0; }
.editor-card-total { text-align: right; margin-left: auto; }
.editor-card-total-num { font-family: 'Playfair Display', serif; font-size: 28px; font-weight: 800; line-height: 1; }
.editor-card-total-label { font-size: 11px; color: #b0a0c0; }
.editor-card-cols-head {
  padding: 8px 24px 4px; display: flex; justify-content: space-between;
  font-size: 11px; color: #b0a0c0; text-transform: uppercase; letter-spacing: 0.07em; font-weight: 700;
}
.editor-entry {
  padding: 8px 24px; display: flex; justify-content: space-between; align-items: center;
  border-top: 1px solid #f5f0fc;
}
.editor-entry-coll { font-size: 13px; color: #4a3060; font-weight: 600; }
.editor-entry-date { font-size: 11px; color: #c0b0d0; }
.editor-entry-count { font-family: 'Playfair Display', serif; font-size: 16px; font-weight: 800; }
.editor-more { padding: 8px 24px; font-size: 12px; color: #c0b0d0; border-top: 1px solid #f5f0fc; }
.editor-empty { padding: 16px 24px; font-size: 13px; color: #d0c0e0; text-align: center; }
.editor-card-bar { padding: 12px 24px 16px; }
.bar-info { display: flex; justify-content: space-between; font-size: 11px; margin-bottom: 5px; }
.bar-track { background: #f0f0f0; border-radius: 4px; height: 6px; overflow: hidden; }
.bar-fill { height: 100%; border-radius: 4px; transition: width 0.8s cubic-bezier(.4,0,.2,1); }

/* COLLECTIONS */
.coll-list { background: #fff; border-radius: 16px; border: 1.5px solid #f0e8fb; overflow: hidden; }
.coll-item { padding: 20px 28px; border-bottom: 1px solid #f5f0fc; }
.coll-item:last-child { border-bottom: none; }
.coll-item-top { display: flex; align-items: center; gap: 16px; margin-bottom: 10px; }
.coll-icon { width: 36px; height: 36px; border-radius: 10px; background: #f5f0fc; display: flex; align-items: center; justify-content: center; font-size: 18px; flex-shrink: 0; }
.coll-name { font-weight: 700; font-size: 15px; color: #2d1f3d; }
.coll-meta { font-size: 12px; color: #b0a0c0; margin-top: 2px; }
.coll-count { margin-left: auto; text-align: right; }
.coll-count-num { font-family: 'Playfair Display', serif; font-size: 24px; font-weight: 800; color: #957DAD; }
.coll-count-label { font-size: 11px; color: #c0b0d0; }
.coll-bar-track { background: #f5f0fc; border-radius: 6px; height: 8px; overflow: hidden; margin-bottom: 10px; }
.coll-bar-fill { height: 100%; border-radius: 6px; background: linear-gradient(90deg, #957DAD, #c4a0d8); transition: width 0.8s cubic-bezier(.4,0,.2,1); }
.chips { display: flex; flex-wrap: wrap; gap: 6px; }
.chip { border-radius: 20px; padding: 3px 10px; font-size: 12px; font-weight: 600; }

/* MODAL */
.modal-overlay {
  position: fixed; inset: 0; z-index: 1000;
  background: #2d1f3d80; backdrop-filter: blur(4px);
  display: flex; align-items: center; justify-content: center;
  opacity: 0; pointer-events: none; transition: opacity 0.3s;
}
.modal-overlay.open { opacity: 1; pointer-events: all; }
.modal {
  background: #fff; border-radius: 20px; padding: 32px 36px; width: 420px; max-width: 95vw;
  box-shadow: 0 20px 60px #957DAD30; border: 1.5px solid #f0e8fb;
  transform: translateY(16px) scale(0.97); transition: transform 0.3s;
}
.modal-overlay.open .modal { transform: translateY(0) scale(1); }
.modal-title { font-family: 'Playfair Display', serif; font-size: 22px; font-weight: 800; color: #2d1f3d; margin-bottom: 4px; }
.modal-sub { font-size: 13px; color: #b0a0c0; margin-bottom: 24px; }
.form-group { margin-bottom: 16px; }
.form-label { display: block; font-size: 12px; color: #9080a8; font-weight: 700; text-transform: uppercase; letter-spacing: 0.06em; margin-bottom: 6px; }
.form-group select, .form-group input { width: 100%; padding: 10px 14px; border-radius: 10px; font-size: 14px; }
.modal-actions { display: flex; gap: 10px; margin-top: 28px; }
.btn-cancel {
  flex: 1; padding: 12px; border-radius: 10px;
  border: 1.5px solid #e8d8f8; background: #faf8ff;
  font-size: 14px; font-weight: 600; color: #9080a8;
  font-family: 'Raleway', sans-serif; cursor: pointer;
}
.btn-cancel:hover { border-color: #957DAD; }
.btn-confirm {
  flex: 2; padding: 12px; border-radius: 10px; border: none;
  background: linear-gradient(135deg, #957DAD, #c4a0d8);
  font-size: 14px; font-weight: 700; color: #fff;
  font-family: 'Raleway', sans-serif; cursor: pointer;
  box-shadow: 0 4px 14px #957DAD30;
}
.btn-confirm:hover { transform: translateY(-1px); box-shadow: 0 6px 20px #957DAD50; }

/* TOAST */
.toast {
  position: fixed; bottom: 28px; left: 50%;
  transform: translateX(-50%) translateY(80px);
  background: #fff; border: 1.5px solid #e8d8f8;
  border-radius: 10px; padding: 12px 24px;
  font-size: 14px; font-weight: 600; color: #2d1f3d;
  box-shadow: 0 8px 30px #957DAD20; z-index: 2000;
  transition: transform 0.3s;
}
.toast.show { transform: translateX(-50%) translateY(0); }

@keyframes fadeUp {
  from { opacity: 0; transform: translateY(14px); }
  to { opacity: 1; transform: translateY(0); }
}

@media (max-width: 600px) {
  .header { padding: 0 16px; }
  .container { padding: 20px 12px 0; }
  .logo-sub { display: none; }
  th:last-child, td:last-child { display: none; }
}
</style>
</head>
<body>

<header class="header">
  <div class="logo">
    <div class="logo-icon">üéÅ</div>
    <div>
      <div class="logo-title">Gift Tracker</div>
      <div class="logo-sub">–°–∏—Å—Ç–µ–º–∞ –æ—Ç—á—ë—Ç–Ω–æ—Å—Ç–∏ —Ä–µ–¥–∞–∫—Ç–æ—Ä–æ–≤</div>
    </div>
  </div>
  <button class="btn-add" onclick="openModal()">
    <span style="font-size:16px">Ôºã</span> –î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å
  </button>
</header>

<div class="container">
  <div class="stats-grid" id="statsGrid"></div>
  <div class="tabs">
    <button class="tab active" onclick="switchTab('log',this)">üìã –ñ—É—Ä–Ω–∞–ª</button>
    <button class="tab" onclick="switchTab('editors',this)">üë©‚Äçüíº –ü–æ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞–º</button>
    <button class="tab" onclick="switchTab('collections',this)">üì¶ –ü–æ –ø–æ–¥–±–æ—Ä–∫–∞–º</button>
  </div>
  <div id="panel-log" class="panel"></div>
  <div id="panel-editors" class="panel" style="display:none"></div>
  <div id="panel-collections" class="panel" style="display:none"></div>
</div>

<div class="modal-overlay" id="modalOverlay" onclick="closeModalOutside(event)">
  <div class="modal">
    <div class="modal-title">–ù–æ–≤–∞—è –∑–∞–ø–∏—Å—å</div>
    <div class="modal-sub">–î–æ–±–∞–≤—å—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø–æ–¥–±–æ—Ä–∫–∏</div>
    <div class="form-group"><label class="form-label">–†–µ–¥–∞–∫—Ç–æ—Ä</label><select id="fEditor"></select></div>
    <div class="form-group"><label class="form-label">–ü–æ–¥–±–æ—Ä–∫–∞</label><select id="fCollection"></select></div>
    <div class="form-group"><label class="form-label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö –∏–¥–µ–π</label><input type="number" id="fCount" min="1" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 10"></div>
    <div class="form-group"><label class="form-label">–î–∞—Ç–∞</label><input type="date" id="fDate"></div>
    <div class="modal-actions">
      <button class="btn-cancel" onclick="closeModal()">–û—Ç–º–µ–Ω–∞</button>
      <button class="btn-confirm" onclick="addEntry()">Ôºã –î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å</button>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
// ‚úèÔ∏è –ù–ê–°–¢–†–û–ô–¢–ï –ü–û–î –°–ï–ë–Ø
const EDITORS = ["–ê–Ω–Ω–∞", "–ú–∞—Ä–∏—è", "–î–∞—Ä—å—è", "–û–ª—å–≥–∞", "–ï–∫–∞—Ç–µ—Ä–∏–Ω–∞"];
const COLLECTIONS = ["–î–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è", "–ù–æ–≤—ã–π –≥–æ–¥", "23 —Ñ–µ–≤—Ä–∞–ª—è", "8 –º–∞—Ä—Ç–∞", "–°–≤–∞–¥—å–±–∞", "–î–µ—Ç—è–º", "–ï–º—É", "–ï–π", "–ö–æ–ª–ª–µ–≥–µ"];

const COLORS = {
  "–ê–Ω–Ω–∞":      { bg: "#FFE8E8", accent: "#E05252" },
  "–ú–∞—Ä–∏—è":     { bg: "#E8F4FF", accent: "#3A7BD5" },
  "–î–∞—Ä—å—è":     { bg: "#E8FFE8", accent: "#3AAE3A" },
  "–û–ª—å–≥–∞":     { bg: "#FFF3E8", accent: "#E07820" },
  "–ï–∫–∞—Ç–µ—Ä–∏–Ω–∞": { bg: "#F3E8FF", accent: "#9B5BD5" },
};
function ec(n) { return COLORS[n] || { bg: "#f0f0f0", accent: "#888" }; }

const KEY = "gift_tracker_v3";
function load() {
  try { const r = localStorage.getItem(KEY); if (r) return JSON.parse(r); } catch(e) {}
  return [
    {id:1, editor:"–ê–Ω–Ω–∞",       collection:"–î–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è", count:12, date:"2026-02-10"},
    {id:2, editor:"–ú–∞—Ä–∏—è",      collection:"–ù–æ–≤—ã–π –≥–æ–¥",     count:8,  date:"2026-02-11"},
    {id:3, editor:"–î–∞—Ä—å—è",      collection:"8 –º–∞—Ä—Ç–∞",       count:15, date:"2026-02-12"},
    {id:4, editor:"–ê–Ω–Ω–∞",       collection:"–°–≤–∞–¥—å–±–∞",       count:6,  date:"2026-02-13"},
    {id:5, editor:"–û–ª—å–≥–∞",      collection:"–î–µ—Ç—è–º",         count:20, date:"2026-02-14"},
    {id:6, editor:"–ú–∞—Ä–∏—è",      collection:"23 —Ñ–µ–≤—Ä–∞–ª—è",    count:9,  date:"2026-02-14"},
    {id:7, editor:"–ï–∫–∞—Ç–µ—Ä–∏–Ω–∞",  collection:"–ï–º—É",           count:11, date:"2026-02-15"},
    {id:8, editor:"–î–∞—Ä—å—è",      collection:"–î–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è", count:7,  date:"2026-02-15"},
    {id:9, editor:"–û–ª—å–≥–∞",      collection:"–ö–æ–ª–ª–µ–≥–µ",       count:14, date:"2026-02-16"},
    {id:10,editor:"–ê–Ω–Ω–∞",       collection:"–ï–π",            count:18, date:"2026-02-17"},
    {id:11,editor:"–ï–∫–∞—Ç–µ—Ä–∏–Ω–∞",  collection:"–ù–æ–≤—ã–π –≥–æ–¥",     count:5,  date:"2026-02-17"},
    {id:12,editor:"–ú–∞—Ä–∏—è",      collection:"8 –º–∞—Ä—Ç–∞",       count:22, date:"2026-02-17"},
  ];
}
function save() { localStorage.setItem(KEY, JSON.stringify(entries)); }

let entries = load();
let fEditor="–í—Å–µ", fColl="–í—Å–µ", fDate="", sortBy="date_desc", activeTab="log";

function fmtDate(d) {
  const [y,m,day] = d.split("-");
  return `${parseInt(day)} ${["—è–Ω–≤","—Ñ–µ–≤","–º–∞—Ä","–∞–ø—Ä","–º–∞–π","–∏—é–Ω","–∏—é–ª","–∞–≤–≥","—Å–µ–Ω","–æ–∫—Ç","–Ω–æ—è","–¥–µ–∫"][parseInt(m)-1]} ${y}`;
}

function getFiltered() {
  let d = [...entries];
  if (fEditor!=="–í—Å–µ") d=d.filter(e=>e.editor===fEditor);
  if (fColl!=="–í—Å–µ")   d=d.filter(e=>e.collection===fColl);
  if (fDate)           d=d.filter(e=>e.date===fDate);
  if (sortBy==="date_desc")  d.sort((a,b)=>b.date.localeCompare(a.date));
  if (sortBy==="date_asc")   d.sort((a,b)=>a.date.localeCompare(b.date));
  if (sortBy==="count_desc") d.sort((a,b)=>b.count-a.count);
  if (sortBy==="count_asc")  d.sort((a,b)=>a.count-b.count);
  return d;
}

function getStats() {
  const total = entries.reduce((s,e)=>s+e.count,0);
  const today = new Date().toISOString().split("T")[0];
  const todayCount = entries.filter(e=>e.date===today).reduce((s,e)=>s+e.count,0);
  const byEditor = EDITORS.map(ed=>({
    name:ed,
    total:entries.filter(e=>e.editor===ed).reduce((s,e)=>s+e.count,0),
    updates:entries.filter(e=>e.editor===ed).length
  })).sort((a,b)=>b.total-a.total);
  const byCollection = COLLECTIONS.map(col=>({
    name:col,
    total:entries.filter(e=>e.collection===col).reduce((s,e)=>s+e.count,0),
    updates:entries.filter(e=>e.collection===col).length
  })).filter(c=>c.total>0).sort((a,b)=>b.total-a.total);
  return {total,todayCount,byEditor,byCollection};
}

function renderStats() {
  const s = getStats();
  const cards = [
    {label:"–í—Å–µ–≥–æ –∏–¥–µ–π –¥–æ–±–∞–≤–ª–µ–Ω–æ", value:s.total,        sub:"–∑–∞ –≤—Å—ë –≤—Ä–µ–º—è",       color:"#957DAD", delay:"0s"},
    {label:"–î–æ–±–∞–≤–ª–µ–Ω–æ —Å–µ–≥–æ–¥–Ω—è",    value:s.todayCount,   sub:"–∑–∞ —Å–µ–≥–æ–¥–Ω—è",          color:"#E07820", delay:"0.07s"},
    {label:"–í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π",        value:entries.length, sub:"–æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –ø–æ–¥–±–æ—Ä–æ–∫", color:"#3A7BD5", delay:"0.14s"},
    {label:"–õ–∏–¥–µ—Ä –ø–æ –∏–¥–µ—è–º",       value:s.byEditor[0]?.name||"‚Äî", sub:(s.byEditor[0]?.total||0)+" –∏–¥–µ–π", color:"#E05252", delay:"0.21s"},
  ];
  document.getElementById("statsGrid").innerHTML = cards.map(c=>`
    <div class="stat-card" style="border:2px solid ${c.color}22;box-shadow:0 2px 16px ${c.color}15;animation-delay:${c.delay}">
      <div class="stat-label">${c.label}</div>
      <div class="stat-value" style="color:${c.color}">${c.value}</div>
      <div class="stat-sub">${c.sub}</div>
    </div>`).join("");
}

function renderLog() {
  const f = getFiltered();
  const hasF = fEditor!=="–í—Å–µ"||fColl!=="–í—Å–µ"||fDate;
  document.getElementById("panel-log").innerHTML = `
    <div class="filters">
      <span class="filter-label">–§–∏–ª—å—Ç—Ä—ã:</span>
      <select onchange="fEditor=this.value;renderAll()">
        <option>–í—Å–µ</option>${EDITORS.map(e=>`<option${fEditor===e?" selected":""}>${e}</option>`).join("")}
      </select>
      <select onchange="fColl=this.value;renderAll()">
        <option>–í—Å–µ</option>${COLLECTIONS.map(c=>`<option${fColl===c?" selected":""}>${c}</option>`).join("")}
      </select>
      <input type="date" value="${fDate}" onchange="fDate=this.value;renderAll()">
      ${hasF?`<button class="btn-reset" onclick="fEditor='–í—Å–µ';fColl='–í—Å–µ';fDate='';renderAll()">‚úï –°–±—Ä–æ—Å–∏—Ç—å</button>`:""}
      <div class="sort-wrap">
        <span class="filter-label">–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞:</span>
        <select onchange="sortBy=this.value;renderAll()">
          <option value="date_desc"${sortBy==="date_desc"?" selected":""}>–°–Ω–∞—á–∞–ª–∞ –Ω–æ–≤—ã–µ</option>
          <option value="date_asc"${sortBy==="date_asc"?" selected":""}>–°–Ω–∞—á–∞–ª–∞ —Å—Ç–∞—Ä—ã–µ</option>
          <option value="count_desc"${sortBy==="count_desc"?" selected":""}>–ë–æ–ª—å—à–µ –∏–¥–µ–π</option>
          <option value="count_asc"${sortBy==="count_asc"?" selected":""}>–ú–µ–Ω—å—à–µ –∏–¥–µ–π</option>
        </select>
      </div>
    </div>
    <div class="table-wrap">
      <table>
        <thead><tr><th>–†–µ–¥–∞–∫—Ç–æ—Ä</th><th>–ü–æ–¥–±–æ—Ä–∫–∞</th><th>–ò–¥–µ–π –¥–æ–±–∞–≤–ª–µ–Ω–æ</th><th>–î–∞—Ç–∞</th><th></th></tr></thead>
        <tbody>${f.length===0
          ?`<tr><td colspan="5" class="table-empty">–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π –ø–æ –≤—ã–±—Ä–∞–Ω–Ω—ã–º —Ñ–∏–ª—å—Ç—Ä–∞–º</td></tr>`
          :f.map(e=>{const c=ec(e.editor);return`<tr>
            <td><div class="editor-cell">
              <div class="editor-avatar" style="background:${c.bg};color:${c.accent}">${e.editor[0]}</div>
              <span class="editor-name">${e.editor}</span>
            </div></td>
            <td><span class="coll-tag">üéÅ ${e.collection}</span></td>
            <td><div class="count-cell">
              <span class="count-num" style="color:${c.accent}">${e.count}</span>
              <span class="count-unit">–∏–¥–µ–π</span>
            </div></td>
            <td><span class="date-val">${fmtDate(e.date)}</span></td>
            <td><button class="btn-del" onclick="delEntry(${e.id})">–£–¥–∞–ª–∏—Ç—å</button></td>
          </tr>`;}).join("")
        }</tbody>
      </table>
      <div class="table-footer">–ü–æ–∫–∞–∑–∞–Ω–æ: ${f.length} –∏–∑ ${entries.length} –∑–∞–ø–∏—Å–µ–π</div>
    </div>`;
}

function renderEditors() {
  const s = getStats();
  document.getElementById("panel-editors").innerHTML = `<div class="editors-grid">${
    s.byEditor.map((ed,i)=>{
      const c=ec(ed.name);
      const edE=entries.filter(e=>e.editor===ed.name).sort((a,b)=>b.date.localeCompare(a.date)).slice(0,4);
      const pct=s.total>0?Math.round(ed.total/s.total*100):0;
      return `<div class="editor-card" style="animation-delay:${i*0.08}s">
        <div class="editor-card-head">
          <div class="editor-big-avatar" style="background:${c.bg};color:${c.accent}">${ed.name[0]}</div>
          <div>
            <div class="editor-card-name">${ed.name}</div>
            <div class="editor-card-meta">${ed.updates} –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π</div>
          </div>
          <div class="editor-card-total">
            <div class="editor-card-total-num" style="color:${c.accent}">${ed.total}</div>
            <div class="editor-card-total-label">–∏–¥–µ–π</div>
          </div>
        </div>
        <div>
          <div class="editor-card-cols-head"><span>–ü–æ–¥–±–æ—Ä–∫–∞</span><span>–ò–¥–µ–π</span></div>
          ${edE.length===0?`<div class="editor-empty">–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π</div>`:edE.map(e=>`
            <div class="editor-entry">
              <div>
                <div class="editor-entry-coll">${e.collection}</div>
                <div class="editor-entry-date">${fmtDate(e.date)}</div>
              </div>
              <span class="editor-entry-count" style="color:${c.accent}">+${e.count}</span>
            </div>`).join("")}
          ${ed.updates>4?`<div class="editor-more">+ –µ—â—ë ${ed.updates-4} –∑–∞–ø–∏—Å–µ–π</div>`:""}
        </div>
        <div class="editor-card-bar">
          <div class="bar-info">
            <span style="color:#b0a0c0">–î–æ–ª—è –æ—Ç –æ–±—â–µ–≥–æ</span>
            <span style="color:${c.accent};font-weight:700">${pct}%</span>
          </div>
          <div class="bar-track"><div class="bar-fill" style="width:${pct}%;background:${c.accent}"></div></div>
        </div>
      </div>`;
    }).join("")
  }</div>`;
}

function renderCollections() {
  const s = getStats();
  const maxC = Math.max(...s.byCollection.map(c=>c.total),1);
  document.getElementById("panel-collections").innerHTML = `<div class="coll-list">${
    s.byCollection.length===0?`<div class="table-empty">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</div>`:
    s.byCollection.map(col=>{
      const pct=Math.round(col.total/maxC*100);
      const colE=entries.filter(e=>e.collection===col.name);
      const editors=[...new Set(colE.map(e=>e.editor))];
      return `<div class="coll-item">
        <div class="coll-item-top">
          <div class="coll-icon">üéÅ</div>
          <div>
            <div class="coll-name">${col.name}</div>
            <div class="coll-meta">${col.updates} –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π</div>
          </div>
          <div class="coll-count">
            <div class="coll-count-num">${col.total}</div>
            <div class="coll-count-label">–∏–¥–µ–π</div>
          </div>
        </div>
        <div class="coll-bar-track"><div class="coll-bar-fill" style="width:${pct}%"></div></div>
        <div class="chips">${editors.map(ed=>{
          const c=ec(ed);
          const cnt=colE.filter(e=>e.editor===ed).reduce((s,e)=>s+e.count,0);
          return `<span class="chip" style="background:${c.bg};color:${c.accent}">${ed}: ${cnt}</span>`;
        }).join("")}</div>
      </div>`;
    }).join("")
  }</div>`;
}

function renderAll() {
  renderStats();
  if(activeTab==="log") renderLog();
  else if(activeTab==="editors") renderEditors();
  else if(activeTab==="collections") renderCollections();
}

function switchTab(name,btn) {
  activeTab=name;
  document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));
  btn.classList.add("active");
  ["log","editors","collections"].forEach(t=>{
    document.getElementById("panel-"+t).style.display=t===name?"":"none";
  });
  renderAll();
}

function openModal() {
  document.getElementById("fEditor").innerHTML=EDITORS.map(e=>`<option>${e}</option>`).join("");
  document.getElementById("fCollection").innerHTML=COLLECTIONS.map(c=>`<option>${c}</option>`).join("");
  document.getElementById("fCount").value="";
  document.getElementById("fDate").value=new Date().toISOString().split("T")[0];
  document.getElementById("modalOverlay").classList.add("open");
}
function closeModal() { document.getElementById("modalOverlay").classList.remove("open"); }
function closeModalOutside(e) { if(e.target===document.getElementById("modalOverlay")) closeModal(); }

function addEntry() {
  const editor=document.getElementById("fEditor").value;
  const collection=document.getElementById("fCollection").value;
  const count=parseInt(document.getElementById("fCount").value);
  const date=document.getElementById("fDate").value;
  if(!count||count<=0){showToast("‚ö†Ô∏è –í–≤–µ–¥–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–¥–µ–π");return;}
  if(!date){showToast("‚ö†Ô∏è –í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É");return;}
  entries.unshift({id:Date.now(),editor,collection,count,date});
  save(); closeModal(); renderAll(); showToast("‚úÖ –ó–∞–ø–∏—Å—å –¥–æ–±–∞–≤–ª–µ–Ω–∞!");
}

function delEntry(id) {
  entries=entries.filter(e=>e.id!==id);
  save(); renderAll(); showToast("üóë –ó–∞–ø–∏—Å—å —É–¥–∞–ª–µ–Ω–∞");
}

function showToast(msg) {
  const t=document.getElementById("toast");
  t.textContent=msg; t.classList.add("show");
  setTimeout(()=>t.classList.remove("show"),2500);
}

renderAll();
</script>
</body>
</html>
